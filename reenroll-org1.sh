#!/bin/bash

# Enrolling Org1's CA Admin
./bin/fabric-ca-client reenroll -d -u https://ca-org1-admin:ca-org1-adminpw@0.0.0.0:7054 --home /tmp/hyperledger/org1/ca/admin --mspdir /tmp/hyperledger/org1/ca/admin --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
# Set CA msp
./bin/fabric-ca-client getcainfo -u https://0.0.0.0:7054 --home /tmp/hyperledger/org1/ca/admin --mspdir /tmp/hyperledger/org1/msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem



# Enroll Peer1
./bin/fabric-ca-client reenroll -d -u https://peer1-org1:peer1PW@0.0.0.0:7054 --mspdir /tmp/hyperledger/org1/peer1/msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem
./bin/fabric-ca-client reenroll -d -u https://peer1-org1:peer1PW@0.0.0.0:7054 --enrollment.profile tls --csr.hosts peer1-org1 --mspdir /tmp/hyperledger/org1/peer1/tls-msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem
#cp /tmp/hyperledger/org1/peer1/tls-msp/keystore/$(ls /tmp/hyperledger/org1/peer1/tls-msp/keystore) /tmp/hyperledger/org1/peer1/tls-msp/keystore/key.pem
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="

# Enroll Peer2
./bin/fabric-ca-client reenroll -d -u https://peer2-org1:peer2PW@0.0.0.0:7054 --mspdir /tmp/hyperledger/org1/peer2/msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem
./bin/fabric-ca-client reenroll -d -u https://peer2-org1:peer2PW@0.0.0.0:7054 --enrollment.profile tls --csr.hosts peer2-org1 --mspdir /tmp/hyperledger/org1/peer2/tls-msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem
#cp /tmp/hyperledger/org1/peer2/tls-msp/keystore/$(ls /tmp/hyperledger/org1/peer2/tls-msp/keystore) /tmp/hyperledger/org1/peer2/tls-msp/keystore/key.pem
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="

# Enroll Org1's Admin
./bin/fabric-ca-client reenroll -d -u https://admin-org1:org1AdminPW@0.0.0.0:7054 --mspdir /tmp/hyperledger/org1/admin/msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="
echo "============================================================================================================================================================="

#mkdir /tmp/hyperledger/org1/peer1/msp/admincerts
#mkdir /tmp/hyperledger/org1/peer2/msp/admincerts
cp /tmp/hyperledger/org1/admin/msp/signcerts/cert.pem /tmp/hyperledger/org1/peer1/msp/admincerts/org1-admin-cert.pem
cp /tmp/hyperledger/org1/admin/msp/signcerts/cert.pem /tmp/hyperledger/org1/peer2/msp/admincerts/org1-admin-cert.pem

# Enroll Org1's User
./bin/fabric-ca-client reenroll -d -u https://user-org1:org1UserPW@0.0.0.0:7054 --mspdir /tmp/hyperledger/org1/user/msp --tls.certfiles /tmp/hyperledger/org1/ca/crypto/ca-cert.pem



